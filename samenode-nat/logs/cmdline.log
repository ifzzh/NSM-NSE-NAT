[root@master01 samenode-nat]# kubectl apply -k .
namespace/ns-nse-composition created
configmap/nat-config-file created
configmap/nginx-config-b9f75kh6cm created
deployment.apps/nse-kernel created
deployment.apps/nse-nat-vpp created
networkservice.networkservicemesh.io/nse-composition created
pod/alpine created
[root@master01 samenode-nat]# watch kubectl get pod -n ns-nse-composition -o wide
[root@master01 samenode-nat]# kubectl get pod -n ns-nse-composition -o wide
NAME                           READY   STATUS     RESTARTS      AGE   IP           NODE     NOMINATED NODE   READINESS GATES
alpine                         0/2     Init:0/1   0             32s   10.16.1.73   node01   <none>           <none>
nse-kernel-5d96b8d6d5-wcvhn    2/2     Running    0             32s   10.16.1.71   node01   <none>           <none>
nse-nat-vpp-6798cb8b4c-hjn8k   1/1     Running    1 (17s ago)   32s   10.16.1.72   node01   <none>           <none>
[root@master01 samenode-nat]# kubectl logs -n ns-nse-composition alpine -c cmd-nsc-init > logs/cmd-nsc-init.log

[root@master01 samenode-nat]# kubectl get pod -n ns-nse-composition -o wide
NAME                           READY   STATUS     RESTARTS      AGE   IP           NODE     NOMINATED NODE   READINESS GATES
alpine                         0/2     Init:0/1   0             60s   10.16.1.73   node01   <none>           <none>
nse-kernel-5d96b8d6d5-wcvhn    2/2     Running    0             60s   10.16.1.71   node01   <none>           <none>
nse-nat-vpp-6798cb8b4c-hjn8k   1/1     Running    1 (45s ago)   60s   10.16.1.72   node01   <none>           <none>
[root@master01 samenode-nat]# kubectl logs -n ns-nse-composition nse-nat-vpp-6798cb8b4c-hjn8k  > logs/nse-nat-vpp.log
[root@master01 samenode-nat]# kubectl describe deployments.apps nse-nat-vpp -n ns-nse-composition 
Name:                   nse-nat-vpp
Namespace:              ns-nse-composition
CreationTimestamp:      Sat, 08 Nov 2025 16:18:27 +0800
Labels:                 app=nse-nat-vpp
Annotations:            deployment.kubernetes.io/revision: 1
Selector:               app=nse-nat-vpp
Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=nse-nat-vpp
           spiffe.io/spiffe-id=true
  Containers:
   nse:
    Image:      ifzzh520/nse-nat-vpp:v1.0.2
    Port:       <none>
    Host Port:  <none>
    Environment:
      NSM_SERVICE_NAME:        nse-composition
      NSM_LABELS:              app:nat
      SPIFFE_ENDPOINT_SOCKET:  unix:///run/spire/sockets/agent.sock
      POD_NAME:                 (v1:metadata.name)
      NSM_NAME:                $(POD_NAME)
      NSM_LOG_LEVEL:           TRACE
      NSM_CONNECT_TO:          unix:///var/lib/networkservicemesh/nsm.io.sock
    Mounts:
      /etc/nat/config.yaml from nat-config-volume (rw,path="config.yaml")
      /run/spire/sockets from spire-agent-socket (ro)
      /var/lib/networkservicemesh from nsm-socket (ro)
  Volumes:
   nat-config-volume:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      nat-config-file
    Optional:  false
   spire-agent-socket:
    Type:          HostPath (bare host directory volume)
    Path:          /run/spire/sockets
    HostPathType:  Directory
   nsm-socket:
    Type:          HostPath (bare host directory volume)
    Path:          /var/lib/networkservicemesh
    HostPathType:  DirectoryOrCreate
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Progressing    True    NewReplicaSetAvailable
  Available      True    MinimumReplicasAvailable
OldReplicaSets:  <none>
NewReplicaSet:   nse-nat-vpp-6798cb8b4c (1/1 replicas created)
Events:
  Type    Reason             Age   From                   Message
  ----    ------             ----  ----                   -------
  Normal  ScalingReplicaSet  112s  deployment-controller  Scaled up replica set nse-nat-vpp-6798cb8b4c to 1
[root@master01 samenode-nat]# kubectl describe pod nse-nat-vpp-6798cb8b4c-hjn8k -n ns-nse-composition 
Name:             nse-nat-vpp-6798cb8b4c-hjn8k
Namespace:        ns-nse-composition
Priority:         0
Service Account:  default
Node:             node01/172.168.1.114
Start Time:       Sat, 08 Nov 2025 16:18:27 +0800
Labels:           app=nse-nat-vpp
                  pod-template-hash=6798cb8b4c
                  spiffe.io/spiffe-id=true
Annotations:      k8s.v1.cni.cncf.io/network-status:
                    [{
                        "name": "kube-ovn",
                        "interface": "eth0",
                        "ips": [
                            "10.16.1.72"
                        ],
                        "mac": "e6:3f:4c:60:9a:37",
                        "default": true,
                        "dns": {},
                        "gateway": [
                            "10.16.0.1"
                        ]
                    }]
                  ovn.kubernetes.io/allocated: true
                  ovn.kubernetes.io/cidr: 10.16.0.0/16
                  ovn.kubernetes.io/gateway: 10.16.0.1
                  ovn.kubernetes.io/ip_address: 10.16.1.72
                  ovn.kubernetes.io/logical_router: ovn-cluster
                  ovn.kubernetes.io/logical_switch: ovn-default
                  ovn.kubernetes.io/mac_address: e6:3f:4c:60:9a:37
                  ovn.kubernetes.io/pod_nic_type: veth-pair
                  ovn.kubernetes.io/routed: true
Status:           Running
IP:               10.16.1.72
IPs:
  IP:           10.16.1.72
Controlled By:  ReplicaSet/nse-nat-vpp-6798cb8b4c
Containers:
  nse:
    Container ID:   containerd://c4f9e7d607098736c46cfcd1107aff90ea0339318efea6665b09fba840ac44e0
    Image:          ifzzh520/nse-nat-vpp:v1.0.2
    Image ID:       docker.io/ifzzh520/nse-nat-vpp@sha256:f792b83a60f3102d3b0c495e36d7c16d86fc3ede2cf18cdb4b4ac1defdcf8832
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Sat, 08 Nov 2025 16:18:44 +0800
    Last State:     Terminated
      Reason:       Error
      Exit Code:    2
      Started:      Sat, 08 Nov 2025 16:18:40 +0800
      Finished:     Sat, 08 Nov 2025 16:18:42 +0800
    Ready:          True
    Restart Count:  1
    Environment:
      NSM_SERVICE_NAME:        nse-composition
      NSM_LABELS:              app:nat
      SPIFFE_ENDPOINT_SOCKET:  unix:///run/spire/sockets/agent.sock
      POD_NAME:                nse-nat-vpp-6798cb8b4c-hjn8k (v1:metadata.name)
      NSM_NAME:                $(POD_NAME)
      NSM_LOG_LEVEL:           TRACE
      NSM_CONNECT_TO:          unix:///var/lib/networkservicemesh/nsm.io.sock
    Mounts:
      /etc/nat/config.yaml from nat-config-volume (rw,path="config.yaml")
      /run/spire/sockets from spire-agent-socket (ro)
      /var/lib/networkservicemesh from nsm-socket (ro)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-27fdf (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  nat-config-volume:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      nat-config-file
    Optional:  false
  spire-agent-socket:
    Type:          HostPath (bare host directory volume)
    Path:          /run/spire/sockets
    HostPathType:  Directory
  nsm-socket:
    Type:          HostPath (bare host directory volume)
    Path:          /var/lib/networkservicemesh
    HostPathType:  DirectoryOrCreate
  kube-api-access-27fdf:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              kubernetes.io/hostname=node01
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason          Age                    From               Message
  ----    ------          ----                   ----               -------
  Normal  Scheduled       2m36s                  default-scheduler  Successfully assigned ns-nse-composition/nse-nat-vpp-6798cb8b4c-hjn8k to node01
  Normal  AddedInterface  2m35s                  multus             Add eth0 [10.16.1.72/16] from kube-ovn
  Normal  Pulled          2m23s                  kubelet            Successfully pulled image "ifzzh520/nse-nat-vpp:v1.0.2" in 12.074s (12.074s including waiting)
  Normal  Pulling         2m20s (x2 over 2m35s)  kubelet            Pulling image "ifzzh520/nse-nat-vpp:v1.0.2"
  Normal  Created         2m20s (x2 over 2m23s)  kubelet            Created container nse
  Normal  Pulled          2m20s                  kubelet            Successfully pulled image "ifzzh520/nse-nat-vpp:v1.0.2" in 886ms (886ms including waiting)
  Normal  Started         2m19s (x2 over 2m23s)  kubelet            Started container nse
[root@master01 samenode-nat]# kubectl get pod -n ns-nse-composition -o wide
NAME                           READY   STATUS     RESTARTS        AGE     IP           NODE     NOMINATED NODE   READINESS GATES
alpine                         0/2     Init:0/1   0               2m53s   10.16.1.73   node01   <none>           <none>
nse-kernel-5d96b8d6d5-wcvhn    2/2     Running    0               2m53s   10.16.1.71   node01   <none>           <none>
nse-nat-vpp-6798cb8b4c-hjn8k   1/1     Running    1 (2m38s ago)   2m53s   10.16.1.72   node01   <none>           <none>
[root@master01 samenode-nat]# 